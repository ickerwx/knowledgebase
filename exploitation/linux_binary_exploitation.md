# Linux Binary Exploitation

## GDB with Stdin a Iput source

`run <<< $(python2 -c 'print "A"*1000') `

## GDB Remote Debgging

`gdbserver :<port> --attach <pid>`

## Memory Layout differences in GDB vs Real

After creating an exploit the offsets are often not like in the normal execution.
 (often fails)
One way to bypass this is to load the coredump of a normal execution run `python poc.py | ./level0` and then `gdb -q ./level0 core`. Gdb will now have the correct offsets.
Another way is the fixenv tool. TODO

## Ret2Libc

Used when stack is non executable. Returns to libc functions with arguments prepared by the payload.

Usual way to do it:
```
checksec
pattern create <num>
run
pattern search <eip>
print system
print exit
find &system,+9999999,"/bin/sh"
```
Exploit must be in memory like this : [padding][system][exit][*"/bin/sh"]

## User After Free Heap Exploitation
Exploitation is based on the fact that chunks of memory with the same size get reused.
Allocation methods: malloc(), strdup(), ..
Free: free(),..

## Finding the right libc version
Leak some pointers from got.plt and then use libc database (https://github.com/niklasb/libc-database.git).
Example:
`./find print <offset1> write <offset2>`
The more values you leak the more accurate the result will get.

## GDB Commands

Set EFLAGS:
```
set $SF = 7
set $eflags |= (1 << $SF) 
```
Bits are CF=0, PF=2, AF=4, ZF=6, SF=7, TF=8, IF=9, DF=10,...

Show Memory Map:
`vmmap`

## Assembling

Get Opcode of instruction:
```
nasm > jmp esp
00000000  FFE4              jmp esp
```
## Inspect Memory
For 64-Bit values:
`x/<n>xg <destination>`

## Permission Issues

`sudo chmod +s /usr/bin/gdb` for special needs binaries, however be sure to remove it after the anaylsis is finished as its a security hole

## Easier address input

Wen using python to create shellcode, you don't have to revert addresses:

```
"\x7f\xff\xff\xff\xdc\x40"[::-1]'  # this is the address 0x7fffffdc40
```
## links

* https://github.com/niklasb/libc-database.git

tags: #exploit #exploitation #linux #binary #links 
